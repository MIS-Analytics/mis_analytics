# DeSAPher


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## The Problem

Working with SAP systems often means dealing with hundreds of tables
with cryptic names like MARA, VBAK, or MAKT. Understanding what these
tables contain and how they relate to each other traditionally requires
extensive documentation lookup or SAP expertise.

## Our Solution

We created a tool that automatically fetches and structures SAP table
definitions from online documentation. This gives us instant access
to: - Field names and their meanings - Data types and lengths -
Relationships between tables (via check tables) - Comprehensive
descriptions of each field - Table names and descriptions

## Benefits

- **Time Saving**: No more manual documentation lookups
- **Better Understanding**: Clear visibility of table structures and
  meanings
- **Easier Data Analysis**: Quick reference for field names and their
  purposes
- **Knowledge Sharing**: Makes SAP data structures more accessible to
  team members

## Future Directions

### 1. Interactive Interface

- Build a searchable interface for quick table/field lookups
- Implement full-text search across descriptions
- Add semantic search using LLMs to find relevant tables by describing
  needs in plain English

### 2. Visual Data Model

- Create interactive graph visualizations showing table relationships
- Highlight primary/foreign key connections
- Enable visual exploration of the SAP data model

### 3. AI-Powered Data Assistant

- Use LLMs with our structured documentation as context
- Generate SQL queries from natural language questions
- Suggest relevant tables for specific business questions
- Provide data model explanations in plain language

# Our plan

As data scientists working with ERP systems like SAP, we often encounter
large datasets with hundreds of cryptically named columns. To better
understand these data sources, we aim to web scrape SAP’s data
dictionary documentation to create programmatic access to table
definitions, column descriptions, and data types.

## Steps

1.  Scrape column description for one table (for example, MARA)
2.  Bring it in to a easily serachable format
3.  Apply process to all tables

### Scrape column description for one table (for example, MARA)

``` python
url = 'https://www.sapdatasheet.org/abap/tabl/mara.html'
```

``` python
response = httpx.get(url)
response
```

``` python
sample_text = '''
<table class="table table-sm">
                                <caption class="text-right sapds-alv">
                                    <a href="/download/abap-tabl-component.php?format=csv&amp;tabname=MARA" title="Download components as CSV file.
The downloaded file contains more columns than displayed here." target="_blank">
                                        <img src="/abap/icon/s_wdvtxe.gif"></a> &nbsp;
                                    <a href="/download/abap-tabl-component.php?format=xls&amp;tabname=MARA" title="Download components as Excel 97-2003 Worksheet (.xls) file.
The downloaded file contains more columns than displayed here." target="_blank">
                                        <img src="/abap/icon/s_x__xls.gif"></a> &nbsp;
                                    <a href="/download/abap-tabl-component.php?format=xlsx&amp;tabname=MARA" title="Download components as Excel Open XML Format Spreadsheet (.xlsx) file.
The downloaded file contains more columns than displayed here." target="_blank">
                                        <img src="/abap/icon/s_lisvie.gif"></a> &nbsp;
                                </caption>
                                <thead>
                                    <tr>
                                        <th class="sapds-alv"> <img src="/abap/icon/s_b_pvre.gif"> </th>
                                        <th class="sapds-alv"> Field </th>
                                        <th class="sapds-alv"> Key </th>
                                        <th class="sapds-alv"> Data Element</th>
                                        <th class="sapds-alv"> Domain</th>
                                        <th class="sapds-alv"> Data<br>Type</th>
                                        <th class="sapds-alv"> Length</th>
                                        <th class="sapds-alv"> Decimal<br>Places</th>
                                        <th class="sapds-alv"> Short Description</th>
                                        <th class="sapds-alv"> Check<br>table</th>
                                    </tr>
                                </thead>
                                <tbody>
                                                                            <tr>
                                            <td class="sapds-alv"> <a id="FIELD_MANDT"></a> 1 </td>
                                            <td class="sapds-alv"> <img src="/abap/icon/s_struct.gif">                                                 <a href="/abap/tabl/mara-mandt.html" title="MANDT" target="_blank">MANDT</a> </td>
                                            <td class="sapds-alv text-center"> <input type="checkbox" name="field_MANDT" disabled="disabled" checked="checked"> </td>
                                            <td class="sapds-alv"> <a href="/abap/dtel/mandt.html" title="Client" target="_blank">MANDT</a> </td>
                                            <td class="sapds-alv"> <a href="/abap/doma/mandt.html" title="Client (key field in client-specific tables)" target="_blank">MANDT</a> </td>
                                            <td class="sapds-alv"> <a href="/abap/doma/datatype.html#values" title="Dictionary Data Type" target="_blank">CLNT</a> </td>
                                            <td class="sapds-alv text-right"> 3 &nbsp; </td>
                                            <td class="sapds-alv text-right"> 0 &nbsp; </td>
                                            <td class="sapds-alv"> Client </td>
                                            <td class="sapds-alv"> <a href="/abap/tabl/t000.html" title="Clients" target="_blank">T000</a> </td>
                                        </tr>
                                                                            <tr>
                                            <td class="sapds-alv"> <a id="FIELD_FASHGRD"></a> 239 </td>
                                            <td class="sapds-alv"> <img src="/abap/icon/s_struct.gif">                                                 <a href="/abap/tabl/mara-fashgrd.html" title="FASHGRD" target="_blank">FASHGRD</a> </td>
                                            <td class="sapds-alv text-center"> <input type="checkbox" name="field_FASHGRD" disabled="disabled"> </td>
                                            <td class="sapds-alv"> <a href="/abap/dtel/fashgrd.html" title="Fashion Grade" target="_blank">FASHGRD</a> </td>
                                            <td class="sapds-alv"> <a href="/abap/doma/fashgrd.html" title="Fashion Grade" target="_blank">FASHGRD</a> </td>
                                            <td class="sapds-alv"> <a href="/abap/doma/datatype.html#values" title="Dictionary Data Type" target="_blank">CHAR</a> </td>
                                            <td class="sapds-alv text-right"> 4 &nbsp; </td>
                                            <td class="sapds-alv text-right"> 0 &nbsp; </td>
                                            <td class="sapds-alv"> Fashion Grade </td>
                                            <td class="sapds-alv"> <a href="/abap/tabl/t6wfg.html" title="Degree of Fashion" target="_blank">T6WFG</a> </td>
                                        </tr>
                                                                    </tbody>
                            </table>'''
```

``` python
soup = BeautifulSoup(response.text, 'lxml')
table = soup.find('table', class_='table table-sm')
```

### Bring it in to a easily serachable format

``` python
headers = [th.text.strip() for th in table.find('thead').find_all('th')]
headers
```

``` python
trs = [tr for tr in table.find('tbody').find_all('tr')]
trs[0]
```

``` python
trs[1]
```

``` python
[td.text.strip() for td in trs[1].find_all('td')]
```

``` python
rows = []
for tr in table.find('tbody').find_all('tr'):
    row = [td.text.strip() for td in tr.find_all('td')]
    rows.append(row)

rows[10]
```

``` python
df = pd.DataFrame(rows, columns=headers)
df.head()
```

------------------------------------------------------------------------

<a
href="https://github.com/MIS-Analytics/mis_analytics/blob/main/mis_analytics/desapher.py#L57"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_sap_table_structure

``` python

def get_sap_table_structure(
    url
):

```

*Scrapes SAP table structure from sapdatasheet.org and returns a pandas
DataFrame*

``` python
df = get_sap_table_structure(url)
df.head()
```

``` python
url_2 = 'https://www.sapdatasheet.org/abap/tabl/makt.html'

df_2 = get_sap_table_structure(url_2)
df_2
```

### Apply process to all tables

------------------------------------------------------------------------

<a
href="https://github.com/MIS-Analytics/mis_analytics/blob/main/mis_analytics/desapher.py#L38"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_sap_table_url

``` python

def get_sap_table_url(
    table_name
):

```

*Constructs sapdatasheet.org URL from SAP table name*

``` python
get_sap_table_url('VBAK')
```

------------------------------------------------------------------------

<a
href="https://github.com/MIS-Analytics/mis_analytics/blob/main/mis_analytics/desapher.py#L132"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_sap_tables_structure

``` python

def get_sap_tables_structure(
    tables
):

```

*Gets structure for multiple SAP tables and combines them into one
DataFrame with a column indicating the source table*

------------------------------------------------------------------------

<a
href="https://github.com/MIS-Analytics/mis_analytics/blob/main/mis_analytics/desapher.py#L57"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_sap_table_structure

``` python

def get_sap_table_structure(
    url
):

```

*Scrapes SAP table structure from sapdatasheet.org and returns a pandas
DataFrame* Returns None if table not found or other error occurs

------------------------------------------------------------------------

<a
href="https://github.com/MIS-Analytics/mis_analytics/blob/main/mis_analytics/desapher.py#L132"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_sap_tables_structure

``` python

def get_sap_tables_structure(
    tables
):

```

*Gets structure for multiple SAP tables and combines them into one
DataFrame with a column indicating the source table*

``` python
tables = ['MARC', 'MARD', 'MARM', 'MBEW']
```

``` python
df = get_sap_tables_structure(tables)
df.sample(10)
```

### Let’s also grab the table description for each table.

``` python
url
```

------------------------------------------------------------------------

<a
href="https://github.com/MIS-Analytics/mis_analytics/blob/main/mis_analytics/desapher.py#L107"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_sap_table_description

``` python

def get_sap_table_description(
    url
):

```

*Scrapes SAP table description from sapdatasheet.org* Returns None if
not found or error occurs

``` python
get_sap_table_description(url)
```

------------------------------------------------------------------------

<a
href="https://github.com/MIS-Analytics/mis_analytics/blob/main/mis_analytics/desapher.py#L132"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_sap_tables_structure

``` python

def get_sap_tables_structure(
    tables
):

```

*Gets structure for multiple SAP tables and combines them into one
DataFrame with a column indicating the source table*

``` python
sap_sheet = get_sap_tables_structure(tables)
sap_sheet.sample(10)
```

``` python
sap_sheet['Table Description'].unique()
```

``` python
data = {
    'MANDT': [100, 100, 100],
    'MATNR': ['MAT001', 'MAT002', 'MAT003'],
    'WERKS': ['1000', '1000', '2000'],
    'PSTAT': ['KVEB', 'KVEB', 'KVEB'],
    'LVORM': [None, None, None],
    'BWTTY': [None, None, None],
    'MMSTA': ['1', '1', '9'],
    'MMSTD': [20200101, 20200115, 20210201],
    'MAABC': ['A', 'B', None],
    'KZKRI': [None, None, None],
    'EKGRP': ['100', '100', '200'],
    'DISPO': ['001', '001', '002'],
    'BESKZ': ['E', 'E', 'X'],
    'SOBSL': [None, None, None],
    'EISBE': [10.0, 20.0, 15.0],
    'MABST': [100.0, 200.0, 150.0],
    'ALTSL': [None, None, None],
    'KZAUS': [None, None, None],
    'AUSDT': [0, 0, 0],
    'NFMAT': [None, None, None],
    'KZBED': [None, 'T', None],
    'RGEKZ': [None, None, None],
    'FEVOR': ['G01', None, 'G02'],
    'BASMG': [1.0, 1.0, 1.0],
    'STAWN': ['84141025', '84141025', '84148073'],
    'HERKL': ['DE', 'DE', 'US'],
    'HERKR': ['05', '05', '16'],
    'EXPME': ['ST', 'ST', 'ST'],
    'MTVER': ['1', '1', '1'],
    'PRCTR': ['PC100', 'PC100', 'PC200'],
    'VERKZ': [None, 'X', None],
    'STLAL': [None, None, None],
    'STLAN': [None, None, None],
    'PLNNR': [None, None, None],
    'APLAL': [None, None, None],
    'FRTME': [None, None, None],
    'LGPRO': ['1001', '1001', '2001'],
    'DISGR': ['2000', '2000', '6000'],
    'SERNP': [None, None, None],
    'PREFE': [None, None, None],
    'PRENE': [None, None, None],
    'SCHGT': [None, None, None],
    'MCRUE': ['X', 'X', 'X'],
    'LFGJA': [2024, 2024, 2025],
    'EISLO': [0.0, 0.0, 0.0],
    'TARGET_STOCK': [50.0, 100.0, 75.0],
    'SCM_SCOST': [0.0, 0.0, 0.0],
    'SCM_LSUOM': [None, None, None],
    'SCM_STRA1': [None, None, None],
}

df_marc = pd.DataFrame(data)
df_marc
```

------------------------------------------------------------------------

<a
href="https://github.com/MIS-Analytics/mis_analytics/blob/main/mis_analytics/desapher.py#L168"
target="_blank" style="float:right; font-size:smaller">source</a>

### convert_sap_types

``` python

def convert_sap_types(
    df:DataFrame, sap_sheet:DataFrame
)->DataFrame:

```

*Converts the columns of the ‘df’ DataFrame to the correct data types
based on ‘sap_sheet’.*

:param df: Pandas DataFrame containing SAP table data (e.g., “df”).
:param sap_sheet: Pandas DataFrame containing SAP metadata with column
data types. :return: Converted Pandas DataFrame.

``` python
df_marc.info()
```

``` python
df_marc_converted = convert_sap_types(df_marc, sap_sheet)
df_marc_converted.head()
```

``` python
df_marc_converted.info()
```

------------------------------------------------------------------------

<a
href="https://github.com/MIS-Analytics/mis_analytics/blob/main/mis_analytics/desapher.py#L194"
target="_blank" style="float:right; font-size:smaller">source</a>

### rename_sap_columns

``` python

def rename_sap_columns(
    df:DataFrame, sap_sheet:DataFrame
)->DataFrame:

```

*Renames the columns in the ‘df’ DataFrame using the ‘Short Description’
from ‘sap_sheet’.* If a column is not found in ‘sap_sheet’, it remains
unchanged.

:param df: Pandas DataFrame containing SAP table data (e.g., “df”).
:param sap_sheet: Pandas DataFrame containing SAP metadata with column
names and short descriptions. :return: DataFrame with renamed columns.

``` python
df_marc_converted = rename_sap_columns(df_marc_converted, sap_sheet)
df_marc_converted.info()
```

``` python
df_marc_converted = clean_col_names(df_marc_converted)
df_marc_converted.info()
```
